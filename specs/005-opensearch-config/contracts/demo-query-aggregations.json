{
  "description": "Strategy 5 (Optional): Filtered Aggregations",
  "use_case": "Faceted search with category/sentiment filtering and aggregation statistics",
  "index": "videos_index",
  "query": {
    "bool": {
      "must": {
        "match": {
          "title": "tutorial"
        }
      },
      "filter": [
        {
          "term": {
            "category": "Education"
          }
        }
      ]
    }
  },
  "aggs": {
    "category_breakdown": {
      "terms": {
        "field": "category",
        "size": 10
      }
    },
    "view_count_stats": {
      "stats": {
        "field": "view_count"
      }
    },
    "published_over_time": {
      "date_histogram": {
        "field": "published_at",
        "calendar_interval": "month"
      }
    }
  },
  "size": 10,
  "_source": [
    "video_id",
    "title",
    "category",
    "view_count"
  ],
  "notes": {
    "bool_query": "Combines must (relevance scoring) and filter (no scoring)",
    "aggregations": {
      "category_breakdown": "Terms aggregation counts documents per category",
      "view_count_stats": "Stats aggregation computes min, max, avg, sum for view_count",
      "published_over_time": "Date histogram groups videos by month"
    },
    "parameters": {
      "filter_field": "Category, sentiment, verified status, etc.",
      "agg_field": "Field to aggregate on (category, sentiment, etc.)",
      "interval": "For date_histogram: month, week, day, etc."
    }
  },
  "example_comments_sentiment_aggregation": {
    "index": "comments_index",
    "query": {
      "bool": {
        "filter": [
          {
            "term": {
              "video_id": "video_12345"
            }
          }
        ]
      }
    },
    "aggs": {
      "sentiment_distribution": {
        "terms": {
          "field": "sentiment",
          "size": 3
        }
      },
      "avg_like_count": {
        "avg": {
          "field": "like_count"
        }
      }
    },
    "note": "Get sentiment breakdown and average likes for all comments on a video"
  }
}
